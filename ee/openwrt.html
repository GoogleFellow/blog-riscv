<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenWrt 基础 | suda-morris 个人博客</title>
    <meta name="description" content="记录学习生活，探索未知领域">
    <link rel="icon" href="/blog/favicon.png">
  <link rel="manifest" href="/blog/manifest.json">
    
    <link rel="preload" href="/blog/assets/css/0.styles.c4b83633.css" as="style"><link rel="preload" href="/blog/assets/js/app.dad6d174.js" as="script"><link rel="preload" href="/blog/assets/js/2.5203ae48.js" as="script"><link rel="preload" href="/blog/assets/js/15.470bbdeb.js" as="script"><link rel="preload" href="/blog/assets/js/4.fa8a62ca.js" as="script"><link rel="preload" href="/blog/assets/js/3.ee9c868d.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.762f9583.js"><link rel="prefetch" href="/blog/assets/js/11.2fcfe9d0.js"><link rel="prefetch" href="/blog/assets/js/12.cfdaaa7e.js"><link rel="prefetch" href="/blog/assets/js/13.1cec2db5.js"><link rel="prefetch" href="/blog/assets/js/14.32ece556.js"><link rel="prefetch" href="/blog/assets/js/16.1146c2b8.js"><link rel="prefetch" href="/blog/assets/js/17.907230eb.js"><link rel="prefetch" href="/blog/assets/js/18.c216624d.js"><link rel="prefetch" href="/blog/assets/js/19.07721fc5.js"><link rel="prefetch" href="/blog/assets/js/20.8611442e.js"><link rel="prefetch" href="/blog/assets/js/21.f40529be.js"><link rel="prefetch" href="/blog/assets/js/22.c9c12d28.js"><link rel="prefetch" href="/blog/assets/js/23.7548c7cb.js"><link rel="prefetch" href="/blog/assets/js/24.7c888ef3.js"><link rel="prefetch" href="/blog/assets/js/25.0e2bea73.js"><link rel="prefetch" href="/blog/assets/js/26.c346f7c6.js"><link rel="prefetch" href="/blog/assets/js/27.ef47ca7c.js"><link rel="prefetch" href="/blog/assets/js/28.0a9e89ff.js"><link rel="prefetch" href="/blog/assets/js/29.2811c366.js"><link rel="prefetch" href="/blog/assets/js/30.97468ce2.js"><link rel="prefetch" href="/blog/assets/js/31.e44ba6cd.js"><link rel="prefetch" href="/blog/assets/js/32.6a61a726.js"><link rel="prefetch" href="/blog/assets/js/33.0eead473.js"><link rel="prefetch" href="/blog/assets/js/34.f63fe7f6.js"><link rel="prefetch" href="/blog/assets/js/35.52be639b.js"><link rel="prefetch" href="/blog/assets/js/36.af0c1d06.js"><link rel="prefetch" href="/blog/assets/js/37.4f5372cb.js"><link rel="prefetch" href="/blog/assets/js/38.064c04dc.js"><link rel="prefetch" href="/blog/assets/js/39.22ec9dd7.js"><link rel="prefetch" href="/blog/assets/js/40.4e625985.js"><link rel="prefetch" href="/blog/assets/js/41.6586df66.js"><link rel="prefetch" href="/blog/assets/js/42.0e31b534.js"><link rel="prefetch" href="/blog/assets/js/43.1d6da04e.js"><link rel="prefetch" href="/blog/assets/js/44.f7ea51d9.js"><link rel="prefetch" href="/blog/assets/js/45.d74ef2c0.js"><link rel="prefetch" href="/blog/assets/js/46.980635ea.js"><link rel="prefetch" href="/blog/assets/js/47.d2bdfdf9.js"><link rel="prefetch" href="/blog/assets/js/48.86bbd8f6.js"><link rel="prefetch" href="/blog/assets/js/49.c9f8c030.js"><link rel="prefetch" href="/blog/assets/js/5.4ad359d4.js"><link rel="prefetch" href="/blog/assets/js/50.0ad0abd1.js"><link rel="prefetch" href="/blog/assets/js/51.c7b9863d.js"><link rel="prefetch" href="/blog/assets/js/52.f0871e9e.js"><link rel="prefetch" href="/blog/assets/js/53.d71408da.js"><link rel="prefetch" href="/blog/assets/js/54.1b3eef38.js"><link rel="prefetch" href="/blog/assets/js/55.a84bedfe.js"><link rel="prefetch" href="/blog/assets/js/56.39b89665.js"><link rel="prefetch" href="/blog/assets/js/57.83bbc676.js"><link rel="prefetch" href="/blog/assets/js/58.05828456.js"><link rel="prefetch" href="/blog/assets/js/59.8fe98ad4.js"><link rel="prefetch" href="/blog/assets/js/6.5080ff4e.js"><link rel="prefetch" href="/blog/assets/js/60.fa16504e.js"><link rel="prefetch" href="/blog/assets/js/61.6a6be627.js"><link rel="prefetch" href="/blog/assets/js/62.eda7f5c3.js"><link rel="prefetch" href="/blog/assets/js/63.726d91bf.js"><link rel="prefetch" href="/blog/assets/js/64.f9b837f0.js"><link rel="prefetch" href="/blog/assets/js/65.2ca4c9dd.js"><link rel="prefetch" href="/blog/assets/js/66.b3f5c11f.js"><link rel="prefetch" href="/blog/assets/js/67.fc0db5ab.js"><link rel="prefetch" href="/blog/assets/js/68.8c6be5ea.js"><link rel="prefetch" href="/blog/assets/js/69.d72640ac.js"><link rel="prefetch" href="/blog/assets/js/7.f49c4cfa.js"><link rel="prefetch" href="/blog/assets/js/70.f49ced8f.js"><link rel="prefetch" href="/blog/assets/js/71.11e87ba5.js"><link rel="prefetch" href="/blog/assets/js/72.41a81933.js"><link rel="prefetch" href="/blog/assets/js/73.50147b93.js"><link rel="prefetch" href="/blog/assets/js/8.6e32f0dc.js"><link rel="prefetch" href="/blog/assets/js/9.67fbd9f3.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.c4b83633.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">suda-morris 个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/cs/" class="nav-link">CS</a></div><div class="nav-item"><a href="/blog/ee/" class="nav-link router-link-active">EE</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link">Others</a></div> <a href="https://github.com/suda-morris/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/cs/" class="nav-link">CS</a></div><div class="nav-item"><a href="/blog/ee/" class="nav-link router-link-active">EE</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link">Others</a></div> <a href="https://github.com/suda-morris/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/ee/about.html" class="sidebar-link">关于本栏目</a></li><li><a href="/blog/ee/openwrt.html" class="active sidebar-link">OpenWrt 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#flash分区" class="sidebar-link">Flash分区</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#文件系统" class="sidebar-link">文件系统</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#软件包管理器-opkg" class="sidebar-link">软件包管理器 OPKG</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#uci-命令系统" class="sidebar-link">UCI 命令系统</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#常用配置操作" class="sidebar-link">常用配置操作</a></li></ul></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="openwrt-基础"><a href="#openwrt-基础" aria-hidden="true" class="header-anchor">#</a> OpenWrt 基础 <span class="badge warn" style="vertical-align:top;" data-v-c13ee5b0>整理中</span></h1> <h2 id="flash分区"><a href="#flash分区" aria-hidden="true" class="header-anchor">#</a> Flash分区</h2> <p>Linux系统对闪存类存储器是采用MTD设备驱动实现的。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>    0.290000<span class="token punctuation">]</span> spi-mt7621 10000b00.spi: sys_freq: 193333333
<span class="token punctuation">[</span>    0.300000<span class="token punctuation">]</span> m25p80 spi32766.0: w25q256 <span class="token punctuation">(</span>32768 Kbytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    0.300000<span class="token punctuation">]</span> m25p80 spi32766.0: using chunked io
<span class="token punctuation">[</span>    0.310000<span class="token punctuation">]</span> 4 ofpart partitions found on MTD device spi32766.0
<span class="token punctuation">[</span>    0.310000<span class="token punctuation">]</span> Creating 4 MTD partitions on <span class="token string">&quot;spi32766.0&quot;</span><span class="token keyword">:</span>
<span class="token punctuation">[</span>    0.320000<span class="token punctuation">]</span> 0x000000000000-0x000000030000 <span class="token keyword">:</span> <span class="token string">&quot;u-boot&quot;</span>
<span class="token punctuation">[</span>    0.320000<span class="token punctuation">]</span> 0x000000030000-0x000000040000 <span class="token keyword">:</span> <span class="token string">&quot;u-boot-env&quot;</span>
<span class="token punctuation">[</span>    0.330000<span class="token punctuation">]</span> 0x000000040000-0x000000050000 <span class="token keyword">:</span> <span class="token string">&quot;factory&quot;</span>
<span class="token punctuation">[</span>    0.340000<span class="token punctuation">]</span> 0x000000050000-0x000002000000 <span class="token keyword">:</span> <span class="token string">&quot;firmware&quot;</span>
<span class="token punctuation">[</span>    0.410000<span class="token punctuation">]</span> 2 uimage-fw partitions found on MTD device firmware
<span class="token punctuation">[</span>    0.410000<span class="token punctuation">]</span> 0x000000050000-0x000000168da1 <span class="token keyword">:</span> <span class="token string">&quot;kernel&quot;</span>
<span class="token punctuation">[</span>    0.420000<span class="token punctuation">]</span> 0x000000168da1-0x000002000000 <span class="token keyword">:</span> <span class="token string">&quot;rootfs&quot;</span>
<span class="token punctuation">[</span>    0.420000<span class="token punctuation">]</span> mtd: device 5 <span class="token punctuation">(</span>rootfs<span class="token punctuation">)</span> <span class="token keyword">set</span> to be root filesystem
<span class="token punctuation">[</span>    0.430000<span class="token punctuation">]</span> 1 squashfs-split partitions found on MTD device rootfs
<span class="token punctuation">[</span>    0.440000<span class="token punctuation">]</span> 0x000000620000-0x000002000000 <span class="token keyword">:</span> <span class="token string">&quot;rootfs_data&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="tip custom-block"><p>系统在SPI设备上创建了4个MTD分区</p></div> <table><thead><tr><th>分区名</th> <th>分区作用</th></tr></thead> <tbody><tr><td>u-boot</td> <td>引导程序</td></tr> <tr><td>u-boot-env</td> <td>引导程序的配置数据</td></tr> <tr><td>factory</td> <td>路由器芯片的初始化参数</td></tr> <tr><td>firmware</td> <td>固件分区</td></tr> <tr><td>kernel</td> <td>固件分区<br>Linux 内核</td></tr> <tr><td>rootfs</td> <td>固件分区<br>文件系统子集</td></tr> <tr><td>rootfs_rom</td> <td>固件分区<br>文件系统子集<br>只读分区子集</td></tr> <tr><td>rootfs_data</td> <td>固件分区<br>文件系统子集<br>可写分区子集</td></tr></tbody></table> <div class="tip custom-block"><p>分区存在子分区，kernel和rootfs就是firmware的子分区，rootfs_rom和rootfs_data就是rootfs的子分区。</p></div> <h3 id="查看系统mtd分配"><a href="#查看系统mtd分配" aria-hidden="true" class="header-anchor">#</a> 查看系统MTD分配</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># cat /proc/mtd</span>
dev:    size   erasesize  name
mtd0: 00030000 00010000 <span class="token string">&quot;u-boot&quot;</span>
mtd1: 00010000 00010000 <span class="token string">&quot;u-boot-env&quot;</span>
mtd2: 00010000 00010000 <span class="token string">&quot;factory&quot;</span>
mtd3: 01fb0000 00010000 <span class="token string">&quot;firmware&quot;</span>
mtd4: 00118da1 00010000 <span class="token string">&quot;kernel&quot;</span>
mtd5: 01e9725f 00010000 <span class="token string">&quot;rootfs&quot;</span>
mtd6: 019e0000 00010000 <span class="token string">&quot;rootfs_data&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="查看系统mtd分配-2"><a href="#查看系统mtd分配-2" aria-hidden="true" class="header-anchor">#</a> 查看系统MTD分配</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># cat /proc/partitions </span>
major   minor  <span class="token comment">#blocks    name</span>
31       0        192   mtdblock0
31       1         64   mtdblock1
31       2         64   mtdblock2
31       3      32448   mtdblock3
31       4       1123   mtdblock4
31       5      31324   mtdblock5
31       6      26496   mtdblock6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="读取-备份factory分区"><a href="#读取-备份factory分区" aria-hidden="true" class="header-anchor">#</a> 读取/备份factory分区</h3> <p>factory 分区（位于 /dev/mtd2）保存了重要的配置参数（如MAC地址，天线匹配参数等）。</p> <h4 id="查看分区内容"><a href="#查看分区内容" aria-hidden="true" class="header-anchor">#</a> 查看分区内容</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># hexdump /dev/mtd2</span>
0000000 7628 0001 ef0c d2af b8a9 0000 0000 0000
0000010 ffff ffff ffff ffff ffff ffff ffff ffff
0000020 0000 0000 0020 0000 ef0c d2af b8a9 ef0c
0000030 d2af b9a9 3422 2000 ffff 0100 0000 0000
0000040 0000 0022 0000 0000 0030 0000 0000 0000
0000050 0081 9400 b040 c640 c31a c2c3 c5c0 0027
0000060 ffff ffff ffff ffff ffff ffff ffff ffff
*
00000a0 c6c6 c4c4 c0c4 c4c0 c4c4 c0c4 c0c0 0000
00000b0 ffff ffff ffff ffff ffff ffff ffff ffff
*
00000f0 0000 0000 00d1 8800 0000 0000 0000 0000
0000100 ffff ffff ffff ffff ffff ffff ffff ffff
*
0000120 0000 0000 0000 0000 0000 0000 0000 0077
0000130 1d11 1d11 7f15 7f15 7f17 7f17 3b10 3b10
0000140 ffff ffff ffff ffff ffff ffff ffff ffff
*
0010000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="备份分区"><a href="#备份分区" aria-hidden="true" class="header-anchor">#</a> 备份分区</h4> <p>使用 <code>dd</code> 命令将分区读到一个文件中，然后使用浏览器下载到本地。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># dd if=/dev/mtd2 of=/www/art.bin</span>
128+0 records <span class="token keyword">in</span>
128+0 records out
root@Widora:~<span class="token comment"># ls -l /www/art.bin</span>
-rw-r--r--    1 root     root         65536 Apr 27 18:26 /www/art.bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="文件系统"><a href="#文件系统" aria-hidden="true" class="header-anchor">#</a> 文件系统</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># df</span>
Filesystem           1K-blocks      Used Available Use% Mounted on
rootfs                   26496       752     25744   3% /
/dev/root                 4864      4864         0 100% /rom
tmpfs                    63232        84     63148   0% /tmp
/dev/mtdblock6           26496       752     25744   3% /overlay
overlayfs:/overlay       26496       752     25744   3% /
tmpfs                      512         0       512   0% /dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol><li>引导程序启动内核完成后，由内核加载 <code>rootfs_rom</code> 只读分区来完成系统的初步启动。<code>rootfs_rom</code> 只读分区采用的是 Linux 内核支持的 <strong>squashFS</strong> 文件系统，加载完毕后将其挂载到 <code>/rom</code> 目录，同时也挂载为 <code>/</code> 目录。</li> <li>系统将使用 <strong>JFFS2</strong> 文件系统格式化的 <code>rootfs_data</code> 可写文件分区并将这部分挂载到 <code>/overlay</code> 目录。</li> <li>系统再将 <code>/overlay</code> 透明挂载为 <code>/</code> 根目录。</li> <li>最后将一部分内存挂载为<code>/tmp</code> 目录。</li></ol> <h3 id="透明挂载根目录"><a href="#透明挂载根目录" aria-hidden="true" class="header-anchor">#</a> 透明挂载根目录/</h3> <div class="tip custom-block"><p>OpenWrt 设计的一个特点是：系统先将 <code>rootfs_rom</code> 挂载为 <code>/</code> 根目录，这样就具备了一个完整的系统，然后再将 <code>rootfs_data</code> 以透明方式挂载在 <code>/</code> 根目录上。</p></div> <ul><li>最终呈现的根文件系统是由 <code>rootfs_rom</code> 和 <code>rootfs_data</code> 两个分区组合在一起的效果。</li> <li>对任何文件的修改（增、删、改）都会记录在 <code>rootfs_data</code> 分区中。</li> <li>读取文件内容时，首先检测 <code>rootfs_data</code> 里的状态，再检测 <code>roots_rom</code> 里的内容，最后输出结果。</li></ul> <div class="warning custom-block"><p>如果修改了一个名为 abc 的文件，那么在 <code>/rom</code> 里还会保留修改之前的那个 abc 文件，同时在 <code>/overlay</code> 里有修改后的 abc 文件，因此所占的空间将会倍增。这样带来的一个好处是，在任何时候，只要删除 <code>/overlay</code> 里所有的文件，就能达到恢复出厂的效果。</p></div> <h3 id="常用文件夹"><a href="#常用文件夹" aria-hidden="true" class="header-anchor">#</a> 常用文件夹</h3> <table><thead><tr><th>文件夹路径</th> <th>作用</th></tr></thead> <tbody><tr><td>/etc/</td> <td>存放系统所有的配置文件</td></tr> <tr><td>/etc/init.d/</td> <td>存放启动的服务脚本</td></tr> <tr><td>/etc/config/</td> <td>存放 OpenWrt 的配置文件，包括网络</td></tr> <tr><td>/tmp/</td> <td>存放临时文件和动态的配置文件</td></tr> <tr><td>/tmp/TZ</td> <td>系统启动后所使用的时区参数</td></tr></tbody></table> <h2 id="软件包管理器-opkg"><a href="#软件包管理器-opkg" aria-hidden="true" class="header-anchor">#</a> 软件包管理器 OPKG</h2> <h3 id="配置-opkg"><a href="#配置-opkg" aria-hidden="true" class="header-anchor">#</a> 配置 OPKG</h3> <p><code>/etc/opkg.conf</code> 文件保存 OPKG 相关设置：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># cat /etc/opkg.conf </span>
dest root /
dest <span class="token function">ram</span> /tmp
lists_dir ext /var/opkg-lists
option overlay_root /overlay
option check_signature 1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><table><thead><tr><th>配置选项</th> <th>说明</th></tr></thead> <tbody><tr><td>dest root</td> <td>安装目标的跟路径</td></tr> <tr><td>dest ram</td> <td>内存临时文件路径</td></tr> <tr><td>lists_dir ext</td> <td>软件包列表文件</td></tr> <tr><td>option overlay_root</td> <td>可写分区挂载位置</td></tr></tbody></table> <h3 id="常用命令搭配"><a href="#常用命令搭配" aria-hidden="true" class="header-anchor">#</a> 常用命令搭配</h3> <table><thead><tr><th>命令</th> <th>说明</th></tr></thead> <tbody><tr><td>opkg update</td> <td>下载服务器上可用的软件包列表</td></tr> <tr><td>opkg upgrade &lt;package&gt;</td> <td>升级软件包</td></tr> <tr><td>opkg install &lt;package&gt;</td> <td>安装软件包</td></tr> <tr><td>opkg configure &lt;package&gt;</td> <td>配置某一个软件包</td></tr> <tr><td>opkg remove &lt;package&gt;</td> <td>卸载软件包</td></tr> <tr><td>opkg list</td> <td>列出全部可用的软件包</td></tr> <tr><td>opkg list-installed</td> <td>列出已安装的软件包</td></tr> <tr><td>opkg list-upgradable</td> <td>列出可以升级的软件包</td></tr> <tr><td>opkg info [package|regexp]</td> <td>显示指定软件包的信息</td></tr> <tr><td>opkg status [package|regexp]</td> <td>显示指定软件包的状态</td></tr> <tr><td>opkg download &lt;package&gt;</td> <td>下载一个软件包到当前目录，但不安装</td></tr></tbody></table> <div class="tip custom-block"><p>软件包列表可能会比较大，因此并不保存在系统中，每次启动需要首先执行 <code>opkg update</code> 取得最新的软件包。</p></div> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># opkg update</span>
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/base/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_base.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/base/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/luci/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_luci.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/luci/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/management/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_management.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/management/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/packages/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_packages.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/packages/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/routing/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_routing.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/routing/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/telephony/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_telephony.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/telephony/Packages.sig.
Signature check passed.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="uci-命令系统"><a href="#uci-命令系统" aria-hidden="true" class="header-anchor">#</a> UCI 命令系统</h2> <p>UCI (Unified Configuration Interface) 是 OpenWrt 中配置参数管理系统，UCI 中已经包含了网络配置、无线配置、系统信息配置等基本路由器所需的主要配置参数。</p> <p>UCI 配置文件全部存储在 <code>/etc/config</code> 目录下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># ls /etc/config/</span>
dhcp           fstab          mountd         shairport      uhttpd
dropbear       luci           network        system         wireless
firewall       mjpg-streamer  rpcd           ucitrack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>常见的 UCI 配置：</p> <table><thead><tr><th>配置文件</th> <th>作用</th></tr></thead> <tbody><tr><td>/etc/config/dhcp</td> <td>面向 LAN 口提供的 IP 地址分配服务配置</td></tr> <tr><td>/etc/config/dropbear</td> <td>SSH 服务配置</td></tr> <tr><td>/etc/config/firewall</td> <td>路由转发，端口转发，防火墙规则</td></tr> <tr><td>/etc/config/network</td> <td>自身网络接口配置</td></tr> <tr><td>/etc/config/system</td> <td>时间服务器时区配置</td></tr> <tr><td>/etc/config/wireless</td> <td>无线网络配置</td></tr></tbody></table> <p>支持 UCI 管理模式的软件包是这样完成启动的（以 <strong>samba</strong> 软件为例）：</p> <ol><li>启动脚本 <code>/etc/init.d/samba</code></li> <li>启动脚本通过 UCI 分析库从 <code>/etc/config/samba</code> 获得启动参数</li> <li>启动脚本完成正常启动</li></ol> <div class="warning custom-block"><p>UCI 配置文件既可以使用 UCI 命令进行修改，也可以使用文本编辑器直接修改。但如果两种方式都使用，需要注意 UCI 命令修改会产生缓存，每次修改好要尽快保存确认，以免出现冲突。</p></div> <h3 id="uci-文件格式"><a href="#uci-文件格式" aria-hidden="true" class="header-anchor">#</a> UCI 文件格式</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>config 'section-type' 'section'
	option 'key' 'value'
	option 'list_key' 'list_value1'
	option 'list_key' 'list_value2'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="tip custom-block"><p>UCI 允许只有 <strong>section-type</strong> 的匿名配置节点。</p></div> <h3 id="uci-命令读写配置"><a href="#uci-命令读写配置" aria-hidden="true" class="header-anchor">#</a> UCI 命令读写配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>uci <span class="token punctuation">[</span><span class="token operator">&lt;</span>option<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>arguments<span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="读取类语法"><a href="#读取类语法" aria-hidden="true" class="header-anchor">#</a> 读取类语法</h4> <table><thead><tr><th>命令</th> <th>说明</th></tr></thead> <tbody><tr><td>uci get &lt;config&gt;.&lt;section&gt;</td> <td>获取节点类型</td></tr> <tr><td>uci get &lt;config&gt;.&lt;section&gt;.&lt;option&gt;</td> <td>获取取得一个值</td></tr> <tr><td>uci show</td> <td>显示全部 UCI 配置</td></tr> <tr><td>uci show &lt;config&gt;</td> <td>显示指定文件配置</td></tr> <tr><td>uci show &lt;config&gt;.&lt;section&gt;</td> <td>显示指定节点的配置</td></tr> <tr><td>uci show &lt;config&gt;.&lt;section&gt;.&lt;option&gt;</td> <td>显示指定选项配置</td></tr> <tr><td>uci changes &lt;config&gt;</td> <td>显示尚未生效的修改记录</td></tr> <tr><td>uci show -X &lt;config&gt;.&lt;section&gt;.&lt;option&gt;</td> <td>显示匿名节点</td></tr></tbody></table> <h4 id="写入类语法"><a href="#写入类语法" aria-hidden="true" class="header-anchor">#</a> 写入类语法</h4> <table><thead><tr><th>命令</th> <th>说明</th></tr></thead> <tbody><tr><td>uci add &lt;config&gt; &lt;section-type&gt;</td> <td>增加一个匿名节点</td></tr> <tr><td>uci set &lt;config&gt;.&lt;section&gt; = &lt;section-type&gt;</td> <td>增加一个节点/修改节点类型</td></tr> <tr><td>uci set &lt;config&gt;.&lt;section&gt;.&lt;option&gt; = &lt;value&gt;</td> <td>增加一个选项值/修改一个选项值</td></tr> <tr><td>uci add_list &lt;config&gt;.&lt;section&gt;.&lt;option&gt; = &lt;value&gt;</td> <td>在列表中增加一个值</td></tr> <tr><td>uci delete &lt;config&gt;.&lt;section&gt;</td> <td>删除指定节点</td></tr> <tr><td>uci delete &lt;config&gt;.&lt;section&gt;.&lt;option&gt;</td> <td>删除指定选项</td></tr> <tr><td>uci delete &lt;config&gt;.&lt;section&gt;.&lt;list&gt;</td> <td>删除列表</td></tr> <tr><td>uci del_list &lt;config&gt;.&lt;section&gt;.&lt;option&gt; = &lt;string&gt;</td> <td>删除列表中的一个值</td></tr> <tr><td>uci commit &lt;config&gt;</td> <td>使修改生效</td></tr></tbody></table> <div class="warning custom-block"><p>UCI 读取总是先读取内存中的缓存，然后再读取文件中的。进行过增删改操作后要执行生效指令，否则所有的修改只留存在缓存中。</p></div> <h2 id="常用配置操作"><a href="#常用配置操作" aria-hidden="true" class="header-anchor">#</a> 常用配置操作</h2> <h3 id="查看-system-配置"><a href="#查看-system-配置" aria-hidden="true" class="header-anchor">#</a> 查看 system 配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># cat /etc/config/system </span>
config system
	option <span class="token function">hostname</span>	Widora
	option timezone	CST-8

config timeserver ntp
	list server	0.openwrt.pool.ntp.org
	list server	1.openwrt.pool.ntp.org
	list server	2.openwrt.pool.ntp.org
	list server	3.openwrt.pool.ntp.org
	option enabled 1
	option enable_server 0
root@Widora:/<span class="token comment"># uci show system</span>
system.@system<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">=</span>system
system.@system<span class="token punctuation">[</span>0<span class="token punctuation">]</span>.hostname<span class="token operator">=</span><span class="token string">'Widora'</span>
system.@system<span class="token punctuation">[</span>0<span class="token punctuation">]</span>.timezone<span class="token operator">=</span><span class="token string">'CST-8'</span>
system.ntp<span class="token operator">=</span>timeserver
system.ntp.server<span class="token operator">=</span><span class="token string">'0.openwrt.pool.ntp.org'</span> <span class="token string">'1.openwrt.pool.ntp.org'</span> <span class="token string">'2.openwrt.pool.ntp.org'</span> <span class="token string">'3.openwrt.pool.ntp.org'</span>
system.ntp.enabled<span class="token operator">=</span><span class="token string">'1'</span>
system.ntp.enable_server<span class="token operator">=</span><span class="token string">'0'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="查看网络配置"><a href="#查看网络配置" aria-hidden="true" class="header-anchor">#</a> 查看网络配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># cat /etc/config/network </span>

config interface <span class="token string">'loopback'</span>
	option ifname <span class="token string">'lo'</span>
	option proto <span class="token string">'static'</span>
	option ipaddr <span class="token string">'127.0.0.1'</span>
	option netmask <span class="token string">'255.0.0.0'</span>

config globals <span class="token string">'globals'</span>
	option ula_prefix <span class="token string">'fdff:c5b2:821c::/48'</span>

config interface <span class="token string">'lan'</span>
	option force_link <span class="token string">'1'</span>
	option macaddr <span class="token string">'0c:ef:af:d2:a9:b9'</span>
	option <span class="token function">type</span> <span class="token string">'bridge'</span>
	option proto <span class="token string">'static'</span>
	option ipaddr <span class="token string">'192.168.8.1'</span>
	option netmask <span class="token string">'255.255.255.0'</span>
	option ip6assign <span class="token string">'60'</span>
	option ifname <span class="token string">'eth0.1'</span>

config interface <span class="token string">'wan'</span>
	option force_link <span class="token string">'1'</span>
	option macaddr <span class="token string">'0c:ef:af:d2:a9:b8'</span>
	option proto <span class="token string">'dhcp'</span>
	option ifname <span class="token string">'eth0.2'</span>

config interface <span class="token string">'wan6'</span>
	option proto <span class="token string">'dhcpv6'</span>
	option ifname <span class="token string">'eth0.2'</span>

config switch
	option name <span class="token string">'switch0'</span>
	option reset <span class="token string">'1'</span>
	option enable_vlan <span class="token string">'1'</span>

config switch_vlan
	option device <span class="token string">'switch0'</span>
	option vlan <span class="token string">'1'</span>
	option ports <span class="token string">'1 2 3 4 6t'</span>

config switch_vlan
	option device <span class="token string">'switch0'</span>
	option vlan <span class="token string">'2'</span>
	option ports <span class="token string">'0 6t'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="开启-wi-fi"><a href="#开启-wi-fi" aria-hidden="true" class="header-anchor">#</a> 开启 Wi-Fi</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>uci <span class="token keyword">set</span> wireless.radio0.disabled<span class="token operator">=</span>0 <span class="token comment"># 使能 Wi-Fi</span>
uci commit wireless <span class="token comment"># 使配置生效</span>
wifi <span class="token comment"># 启动 Wi-Fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="查看当前网络"><a href="#查看当前网络" aria-hidden="true" class="header-anchor">#</a> 查看当前网络</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># ifconfig</span>
br-lan    Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B9  
          inet addr:192.168.8.1  Bcast:192.168.8.255  Mask:255.255.255.0
          inet6 addr: fe80::eef:afff:fed2:a9b9/64 Scope:Link
          inet6 addr: fdff:c5b2:821c::1/60 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:574264 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1217669 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:48102567 <span class="token punctuation">(</span>45.8 MiB<span class="token punctuation">)</span>  TX bytes:1634912136 <span class="token punctuation">(</span>1.5 GiB<span class="token punctuation">)</span>

eth0      Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B8  
          inet6 addr: fe80::eef:afff:fed2:a9b8/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1225320 errors:0 dropped:0 overruns:0 frame:0
          TX packets:579507 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1641989813 <span class="token punctuation">(</span>1.5 GiB<span class="token punctuation">)</span>  TX bytes:59132909 <span class="token punctuation">(</span>56.3 MiB<span class="token punctuation">)</span>
          Interrupt:5 

eth0.1    Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B8  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1 errors:0 dropped:1 overruns:0 frame:0
          TX packets:3544 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:46 <span class="token punctuation">(</span>46.0 B<span class="token punctuation">)</span>  TX bytes:244206 <span class="token punctuation">(</span>238.4 KiB<span class="token punctuation">)</span>

eth0.2    Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B8  
          inet addr:192.168.1.5  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::eef:afff:fed2:a9b8/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1176423 errors:0 dropped:10706 overruns:0 frame:0
          TX packets:575928 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1617670919 <span class="token punctuation">(</span>1.5 GiB<span class="token punctuation">)</span>  TX bytes:56565373 <span class="token punctuation">(</span>53.9 MiB<span class="token punctuation">)</span>

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:294 errors:0 dropped:0 overruns:0 frame:0
          TX packets:294 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:41961 <span class="token punctuation">(</span>40.9 KiB<span class="token punctuation">)</span>  TX bytes:41961 <span class="token punctuation">(</span>40.9 KiB<span class="token punctuation">)</span>

ra0       Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B8  
          inet6 addr: fe80::eef:afff:fed2:a9b8/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:641847 errors:830 dropped:0 overruns:0 frame:0
          TX packets:1228723 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:70965355 <span class="token punctuation">(</span>67.6 MiB<span class="token punctuation">)</span>  TX bytes:1630822247 <span class="token punctuation">(</span>1.5 GiB<span class="token punctuation">)</span>
          Interrupt:6 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><table><thead><tr><th>网络设备名</th> <th>说明</th></tr></thead> <tbody><tr><td>br-lan</td> <td>虚拟设备，LAN 口桥接设备，包含通过 LAN 口和 WAN 口连入系统的设备统一桥接</td></tr> <tr><td>eth0</td> <td>真实设备，CPU 内部到交换机芯片之间只有一个接口</td></tr> <tr><td>eth0.1</td> <td>虚拟设备，由 VLAN 划分的有线的 LAN 口，VLAN 编号为 1</td></tr> <tr><td>eth0.2</td> <td>虚拟设备，由 VLAN 划分的有线的 LAN 口，VLAN编号为 2</td></tr> <tr><td>lo</td> <td>虚拟设备，回环设备</td></tr> <tr><td>ra0</td> <td>真实设备，启动 Wi-Fi 后将会产生此无线设备</td></tr> <tr><td>pppoe-wan</td> <td>虚拟设备，是 PPPoE 拨号上网成功后产生的</td></tr></tbody></table> <h3 id="查看-br-lan-桥状态"><a href="#查看-br-lan-桥状态" aria-hidden="true" class="header-anchor">#</a> 查看 br-lan 桥状态</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># brctl show</span>
bridge name	bridge <span class="token function">id</span>			STP enabled	interfaces
br-lan		7fff.0cefafd2a9b9	no			eth0.1
											ra0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="查看内核日志"><a href="#查看内核日志" aria-hidden="true" class="header-anchor">#</a> 查看内核日志</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># logread </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="查看当前-vlan-划分"><a href="#查看当前-vlan-划分" aria-hidden="true" class="header-anchor">#</a> 查看当前 VLAN 划分</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># swconfig dev switch0 show</span>
Global attributes:
	enable_vlan: 1
	alternate_vlan_disable: 0
	bc_storm_protect: 0
	led_frequency: 0
Port 0:
	disable: 0
	doubletag: 0
	untag: 1
	led: 5
	lan: 1
	recv_bad: 0
	recv_good: 2205
	tr_bad: 0
	tr_good: 52155
	pvid: 2
	link: port:0 link:up speed:100baseT full-duplex 
Port 1:
	disable: 0
	doubletag: 0
	untag: 1
	led: 5
	lan: 1
	recv_bad: 0
	recv_good: 0
	tr_bad: 0
	tr_good: 0
	pvid: 1
	link: port:1 link:down
Port 2:
	disable: 0
	doubletag: 0
	untag: 1
	led: 5
	lan: 1
	recv_bad: 0
	recv_good: 0
	tr_bad: 0
	tr_good: 0
	pvid: 1
	link: port:2 link:down
Port 3:
	disable: 0
	doubletag: 0
	untag: 1
	led: 5
	lan: 1
	recv_bad: 0
	recv_good: 0
	tr_bad: 0
	tr_good: 0
	pvid: 1
	link: port:3 link:down
Port 4:
	disable: 0
	doubletag: 0
	untag: 1
	led: 5
	lan: 1
	recv_bad: 0
	recv_good: 0
	tr_bad: 0
	tr_good: 0
	pvid: 1
	link: port:4 link:down
Port 5:
	disable: 1
	doubletag: 0
	untag: 0
	led: ???
	lan: 1
	recv_bad: 0
	recv_good: 0
	tr_bad: 0
	tr_good: 0
	pvid: 0
	link: port:5 link:down
Port 6:
	disable: 0
	doubletag: 0
	untag: 0
	led: ???
	lan: ???
	recv_bad: ???
	recv_good: ???
	tr_bad: ???
	tr_good: ???
	pvid: 0
	link: port:6 link:up speed:1000baseT full-duplex 
VLAN 1:
	ports: 1 2 3 4 6t 
VLAN 2:
	ports: 0 6t 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><div class="tip custom-block"><p>哪个网口是 LAN， 哪个是 WAN， 是由 VLAN 划分的。VLAN1 为 LAN 口，包含 1、2、3、4 接口；VLAN2 为 WAN 口，包含了 0 接口。</p></div> <h3 id="配置-wan-口外网"><a href="#配置-wan-口外网" aria-hidden="true" class="header-anchor">#</a> 配置 WAN 口外网</h3> <h3 id="查看-wan-口配置"><a href="#查看-wan-口配置" aria-hidden="true" class="header-anchor">#</a> 查看 WAN 口配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># uci show network.wan</span>
network.wan<span class="token operator">=</span>interface
network.wan.force_link<span class="token operator">=</span><span class="token string">'1'</span>
network.wan.macaddr<span class="token operator">=</span><span class="token string">'0c:ef:af:d2:a9:b8'</span>
network.wan.proto<span class="token operator">=</span><span class="token string">'dhcp'</span>
network.wan.ifname<span class="token operator">=</span><span class="token string">'eth0.2'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><table><thead><tr><th>选项</th> <th>说明</th> <th>可选值</th></tr></thead> <tbody><tr><td>ifname</td> <td>设备接口名</td> <td>eth0.2</td></tr> <tr><td>proto</td> <td>协议类型</td> <td>static：静态 IP 地址<br>dhcp：动态获取 IP 地址<br>pppoe：拨号上网<br>pptp：远程 VPN 服务器<br>3g：连接 3G/4G 无线电话网络</td></tr> <tr><td>macaddr</td> <td>WAN 口 MAC 地址，修改该地址即可实现 MAC 地址克隆</td> <td>首次数据根据 factory 分区内参数自动生成</td></tr></tbody></table></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/suda-morris/blog/edit/master/docs/ee/openwrt.md" target="_blank" rel="noopener noreferrer">编辑此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">5/12/2019, 10:54:14 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/ee/about.html" class="prev">
          关于本栏目
        </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.dad6d174.js" defer></script><script src="/blog/assets/js/2.5203ae48.js" defer></script><script src="/blog/assets/js/15.470bbdeb.js" defer></script><script src="/blog/assets/js/4.fa8a62ca.js" defer></script><script src="/blog/assets/js/3.ee9c868d.js" defer></script>
  </body>
</html>
