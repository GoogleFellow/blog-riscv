(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{263:function(t,a,s){"use strict";s.r(a);var r=s(4),v=Object(r.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"openwrt-基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#openwrt-基础","aria-hidden":"true"}},[t._v("#")]),t._v(" OpenWrt 基础 "),s("Badge",{attrs:{text:"整理中",type:"warn"}})],1),t._v(" "),s("h2",{attrs:{id:"flash分区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flash分区","aria-hidden":"true"}},[t._v("#")]),t._v(" Flash分区")]),t._v(" "),s("p",[t._v("Linux系统对闪存类存储器是采用MTD设备驱动实现的。")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"u-boot"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"u-boot-env"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"factory"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"firmware"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rootfs"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("系统在SPI设备上创建了4个MTD分区")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("分区ID号")]),t._v(" "),s("th",[t._v("分区位置")]),t._v(" "),s("th",[t._v("分区容量")]),t._v(" "),s("th",[t._v("分区作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("u-boot")]),t._v(" "),s("td",[t._v("0x00000000-0x00030000")]),t._v(" "),s("td",[t._v("192KB")]),t._v(" "),s("td",[t._v("引导程序")])]),t._v(" "),s("tr",[s("td",[t._v("u-boot-env")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("引导程序的配置数据")])]),t._v(" "),s("tr",[s("td",[t._v("factory")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("路由器芯片的初始化参数")])]),t._v(" "),s("tr",[s("td",[t._v("firmware")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("固件分区")])]),t._v(" "),s("tr",[s("td",[t._v("rootfs")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("固件分区"),s("br"),t._v("文件系统子集")])]),t._v(" "),s("tr",[s("td",[t._v("rootfs_data")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("固件分区"),s("br"),t._v("文件系统子集"),s("br"),t._v("可写分区子集")])])])]),t._v(" "),s("p",[s("strong",[t._v("TODO：插入示意图")])]),t._v(" "),s("ul",[s("li",[t._v("分区存在子分区，kernel和rootfs就是firmware的子分区，rootfs_rom和rootfs_data就是rootfs的子分区。")])]),t._v(" "),s("h3",{attrs:{id:"查看系统mtd分配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看系统mtd分配","aria-hidden":"true"}},[t._v("#")]),t._v(" 查看系统MTD分配")]),t._v(" "),s("p",[s("strong",[t._v("TODO：命令 cat /proc/mtd 的结果")])]),t._v(" "),s("h3",{attrs:{id:"查看系统mtd分配-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看系统mtd分配-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 查看系统MTD分配")]),t._v(" "),s("p",[s("strong",[t._v("TODO：命令 cat /proc/partitions的结果")])]),t._v(" "),s("h3",{attrs:{id:"读取-备份factory分区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#读取-备份factory分区","aria-hidden":"true"}},[t._v("#")]),t._v(" 读取/备份factory分区")]),t._v(" "),s("p",[t._v("factory分区是非文件系统的，里面保存的是配置（如MAC地址，天线匹配参数等）。前文所述，factory分区的设备文件是/dev/mtd2")]),t._v(" "),s("h4",{attrs:{id:"查看分区内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看分区内容","aria-hidden":"true"}},[t._v("#")]),t._v(" 查看分区内容")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("hexdump -C /dev/mtd2\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h4",{attrs:{id:"备份分区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份分区","aria-hidden":"true"}},[t._v("#")]),t._v(" 备份分区")]),t._v(" "),s("h2",{attrs:{id:"文件系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件系统","aria-hidden":"true"}},[t._v("#")]),t._v(" 文件系统")]),t._v(" "),s("ol",[s("li",[t._v("引导程序启动内核完成后，由内核加载 "),s("code",[t._v("rootfs_rom")]),t._v(" 只读分区部分来完成系统的初步启动。"),s("code",[t._v("rootfs_rom")]),t._v(" 只读分区采用的是 Linux 内核支持的 "),s("strong",[t._v("squashFS")]),t._v(" 文件系统，加载完毕后将其挂载到 "),s("code",[t._v("/rom")]),t._v(" 目录，同时也挂载为 "),s("code",[t._v("/")]),t._v(" 目录。")]),t._v(" "),s("li",[t._v("系统将使用 "),s("strong",[t._v("JFFS2")]),t._v(" 文件系统格式化的 "),s("code",[t._v("rootfs_data")]),t._v(" 可写文件分区并将这部分挂载到 "),s("code",[t._v("/overlay")]),t._v(" 目录。")]),t._v(" "),s("li",[t._v("系统再将 "),s("code",[t._v("/overlay")]),t._v(" 透明挂载为 "),s("code",[t._v("/")]),t._v(" 根目录。")]),t._v(" "),s("li",[t._v("最后将一部分内存挂载为"),s("code",[t._v("/tmp")]),t._v(" 目录。")])]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("df命令输出\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])},[],!1,null,null,null);a.default=v.exports}}]);