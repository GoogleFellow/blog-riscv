<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机组成原理 | suda-morris 个人博客</title>
    <meta name="description" content="记录学习生活，探索未知领域">
    <link rel="icon" href="/blog/favicon.png">
  <link rel="manifest" href="/blog/manifest.json">
    
    <link rel="preload" href="/blog/assets/css/0.styles.6499505b.css" as="style"><link rel="preload" href="/blog/assets/js/app.90b00457.js" as="script"><link rel="preload" href="/blog/assets/js/2.791c5530.js" as="script"><link rel="preload" href="/blog/assets/js/3.045f78bc.js" as="script"><link rel="preload" href="/blog/assets/js/8.f5935c22.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.bd24192f.js"><link rel="prefetch" href="/blog/assets/js/11.8cfc5ea9.js"><link rel="prefetch" href="/blog/assets/js/12.36d6d5b3.js"><link rel="prefetch" href="/blog/assets/js/13.1b4b524a.js"><link rel="prefetch" href="/blog/assets/js/14.332197fd.js"><link rel="prefetch" href="/blog/assets/js/15.725c1b86.js"><link rel="prefetch" href="/blog/assets/js/16.6d372dce.js"><link rel="prefetch" href="/blog/assets/js/17.b247933d.js"><link rel="prefetch" href="/blog/assets/js/18.12c09f19.js"><link rel="prefetch" href="/blog/assets/js/19.a4bcac25.js"><link rel="prefetch" href="/blog/assets/js/20.0ba57639.js"><link rel="prefetch" href="/blog/assets/js/21.abfc5bf5.js"><link rel="prefetch" href="/blog/assets/js/22.bfe90bbf.js"><link rel="prefetch" href="/blog/assets/js/23.0759a267.js"><link rel="prefetch" href="/blog/assets/js/24.d3ccfa3d.js"><link rel="prefetch" href="/blog/assets/js/25.d1852a96.js"><link rel="prefetch" href="/blog/assets/js/26.7e76c7ff.js"><link rel="prefetch" href="/blog/assets/js/27.39ac2d7d.js"><link rel="prefetch" href="/blog/assets/js/28.34d21004.js"><link rel="prefetch" href="/blog/assets/js/29.67a6568a.js"><link rel="prefetch" href="/blog/assets/js/30.4ec2df5f.js"><link rel="prefetch" href="/blog/assets/js/31.03343ecb.js"><link rel="prefetch" href="/blog/assets/js/32.08cb6184.js"><link rel="prefetch" href="/blog/assets/js/33.642d668c.js"><link rel="prefetch" href="/blog/assets/js/34.931ac4d5.js"><link rel="prefetch" href="/blog/assets/js/35.da9716bc.js"><link rel="prefetch" href="/blog/assets/js/36.a2cff952.js"><link rel="prefetch" href="/blog/assets/js/37.5a868cda.js"><link rel="prefetch" href="/blog/assets/js/38.28ce2c5b.js"><link rel="prefetch" href="/blog/assets/js/39.b06c3d27.js"><link rel="prefetch" href="/blog/assets/js/4.1678631d.js"><link rel="prefetch" href="/blog/assets/js/40.14ba66e6.js"><link rel="prefetch" href="/blog/assets/js/41.17141f22.js"><link rel="prefetch" href="/blog/assets/js/42.326ae10d.js"><link rel="prefetch" href="/blog/assets/js/43.bf0fe9c2.js"><link rel="prefetch" href="/blog/assets/js/44.8a102433.js"><link rel="prefetch" href="/blog/assets/js/45.6fa9ec99.js"><link rel="prefetch" href="/blog/assets/js/46.72a015aa.js"><link rel="prefetch" href="/blog/assets/js/47.4dcbcf94.js"><link rel="prefetch" href="/blog/assets/js/48.b1924265.js"><link rel="prefetch" href="/blog/assets/js/49.9e065a9c.js"><link rel="prefetch" href="/blog/assets/js/5.b5bff20c.js"><link rel="prefetch" href="/blog/assets/js/50.1d91027e.js"><link rel="prefetch" href="/blog/assets/js/51.fe11f7a7.js"><link rel="prefetch" href="/blog/assets/js/52.db1b29ef.js"><link rel="prefetch" href="/blog/assets/js/53.8ecded48.js"><link rel="prefetch" href="/blog/assets/js/54.a7f4ff51.js"><link rel="prefetch" href="/blog/assets/js/55.71281090.js"><link rel="prefetch" href="/blog/assets/js/56.1a372923.js"><link rel="prefetch" href="/blog/assets/js/57.fd17673a.js"><link rel="prefetch" href="/blog/assets/js/58.d9fa7cd7.js"><link rel="prefetch" href="/blog/assets/js/59.80ef8740.js"><link rel="prefetch" href="/blog/assets/js/6.602a99b0.js"><link rel="prefetch" href="/blog/assets/js/60.3cdc2357.js"><link rel="prefetch" href="/blog/assets/js/61.5bfada55.js"><link rel="prefetch" href="/blog/assets/js/62.955c50be.js"><link rel="prefetch" href="/blog/assets/js/63.1d31a57a.js"><link rel="prefetch" href="/blog/assets/js/64.191ff3f8.js"><link rel="prefetch" href="/blog/assets/js/65.12f8db5d.js"><link rel="prefetch" href="/blog/assets/js/66.0ac747ba.js"><link rel="prefetch" href="/blog/assets/js/67.fa8cd423.js"><link rel="prefetch" href="/blog/assets/js/68.ef65afa9.js"><link rel="prefetch" href="/blog/assets/js/69.34322fd6.js"><link rel="prefetch" href="/blog/assets/js/7.5b21bcc5.js"><link rel="prefetch" href="/blog/assets/js/70.f784a525.js"><link rel="prefetch" href="/blog/assets/js/71.da87574f.js"><link rel="prefetch" href="/blog/assets/js/72.c9455788.js"><link rel="prefetch" href="/blog/assets/js/73.78352056.js"><link rel="prefetch" href="/blog/assets/js/74.5f26ec01.js"><link rel="prefetch" href="/blog/assets/js/75.670295e0.js"><link rel="prefetch" href="/blog/assets/js/76.5e68f368.js"><link rel="prefetch" href="/blog/assets/js/77.9f4e088d.js"><link rel="prefetch" href="/blog/assets/js/78.14f2b86b.js"><link rel="prefetch" href="/blog/assets/js/79.53449ed5.js"><link rel="prefetch" href="/blog/assets/js/80.671f5ff4.js"><link rel="prefetch" href="/blog/assets/js/9.3705f5a3.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.6499505b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">suda-morris 个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/cs/" class="nav-link router-link-active">CS</a></div><div class="nav-item"><a href="/blog/ee/" class="nav-link">EE</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link">Others</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://beautifuldingbats.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Beautiful Dingbats
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.draw.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  draw.io
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://devdocs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DevDocs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://explainshell.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Explain Shell
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.neat-reader.com/webapp#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Neat Reader
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://bootlin.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bootlin
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://mirrors.tuna.tsinghua.edu.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TUNA
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/suda-morris/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/cs/" class="nav-link router-link-active">CS</a></div><div class="nav-item"><a href="/blog/ee/" class="nav-link">EE</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link">Others</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://beautifuldingbats.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Beautiful Dingbats
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.draw.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  draw.io
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://devdocs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DevDocs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://explainshell.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Explain Shell
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.neat-reader.com/webapp#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Neat Reader
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://bootlin.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bootlin
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://mirrors.tuna.tsinghua.edu.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TUNA
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/suda-morris/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/cs/about.html" class="sidebar-link">关于本栏目</a></li><li><a href="/blog/cs/bash.html" class="sidebar-link">𝙗𝙖𝙨𝙝 基础</a></li><li><a href="/blog/cs/bit_ops.html" class="sidebar-link">位运算技巧</a></li><li><a href="/blog/cs/cmake.html" class="sidebar-link">𝘾𝙈𝙖𝙠𝙚 基础</a></li><li><a href="/blog/cs/computer_composition.html" class="active sidebar-link">计算机组成原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#知识地图" class="sidebar-link">知识地图</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#冯诺依曼体系结构" class="sidebar-link">冯诺依曼体系结构</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#提高-cpu-性能的方式" class="sidebar-link">提高 CPU 性能的方式</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#mips-指令" class="sidebar-link">MIPS 指令</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#cpu-内部寄存器" class="sidebar-link">CPU 内部寄存器</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#elf-文件" class="sidebar-link">ELF 文件</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#程序装载" class="sidebar-link">程序装载</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#动态链接" class="sidebar-link">动态链接</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#二进制编码" class="sidebar-link">二进制编码</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#unicode-和-utf-8" class="sidebar-link">Unicode 和 UTF-8</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#加法器" class="sidebar-link">加法器</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#乘法器" class="sidebar-link">乘法器</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#定点数" class="sidebar-link">定点数</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#浮点数" class="sidebar-link">浮点数</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#指令-运算-cpu" class="sidebar-link">指令+运算=CPU</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#构造一个最简单的-cpu" class="sidebar-link">构造一个最简单的 CPU</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#现代处理器的流水线设计" class="sidebar-link">现代处理器的流水线设计</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#冒险-hazard" class="sidebar-link">冒险 (Hazard)</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#多发射和超标量" class="sidebar-link">多发射和超标量</a></li><li class="sidebar-sub-header"><a href="/blog/cs/computer_composition.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog/cs/design_pattern.html" class="sidebar-link">设计模式 𝘾 语言描述</a></li><li><a href="/blog/cs/gcc_toolchains.html" class="sidebar-link">𝙂𝘾𝘾 工具链基础</a></li><li><a href="/blog/cs/git.html" class="sidebar-link">𝙂𝙞𝙩 基础</a></li><li><a href="/blog/cs/logistic_regression.html" class="sidebar-link">逻辑回归</a></li><li><a href="/blog/cs/lwip.html" class="sidebar-link">𝙇𝙬𝙄𝙋 基础</a></li><li><a href="/blog/cs/keras.html" class="sidebar-link">𝙆𝙚𝙧𝙖𝙨 基础</a></li><li><a href="/blog/cs/scala.html" class="sidebar-link">𝙎𝙘𝙖𝙡𝙖 基础</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="计算机组成原理"><a href="#计算机组成原理" class="header-anchor">#</a> 计算机组成原理</h1> <h2 id="知识地图"><a href="#知识地图" class="header-anchor">#</a> 知识地图</h2> <p><img src="/blog/assets/img/knowledge_map.12bc9800.jpg" alt="知识图谱"></p> <h2 id="冯诺依曼体系结构"><a href="#冯诺依曼体系结构" class="header-anchor">#</a> 冯诺依曼体系结构</h2> <p><img src="/blog/assets/img/Von_Neumann_architecture.76984515.jpg" alt="冯诺依曼体系结构"></p> <h2 id="提高-cpu-性能的方式"><a href="#提高-cpu-性能的方式" class="header-anchor">#</a> 提高 CPU 性能的方式</h2> <ol><li>增加 CPU 核心的数量，通过并行计算来提升性能</li> <li>使用更先进的 CPU 制造工艺</li> <li>加速大概率事件（比如机器学习中，99% 都是向量和矩阵计算）</li> <li>通过流水线提高性能，拆分 CPU 指令执行的过程，细化运行</li> <li>通过预测提高性能</li></ol> <h2 id="mips-指令"><a href="#mips-指令" class="header-anchor">#</a> MIPS 指令</h2> <p><img src="/blog/assets/img/mips_instruction.b1ade5f8.jpeg" alt="MIPS 指令"></p> <p>MIPS 指令是一个 32 位的整数，高 6 位叫操作码，代表这条指令具体是一条什么样的指令。</p> <ul><li>R 指令一般用来做算数和逻辑操作，里面有读取和写入数据的寄存器的地址。如果是逻辑位移操作，后面还有位移操作的位移量，而最后的功能码，则是在前面的操作码不够的时候，扩展操作码表示对应的具体指令的。</li> <li>I 指令通常是用在数据传输、条件分支以及在运算的时候使用的并非变量而是常数。这个时候没有了位移量和功能码，也没有了第三个寄存器，而是把这三个部分直接合并成了一个地址值或者一个常数。</li> <li>J 指令就是一个跳转指令，高 6 位之外的 26 位都是一个跳转后的地址。</li></ul> <h2 id="cpu-内部寄存器"><a href="#cpu-内部寄存器" class="header-anchor">#</a> CPU 内部寄存器</h2> <p><img src="/blog/assets/img/cpu_registers.cdba5c17.jpg" alt="CPU 内部寄存器"></p> <ul><li>条件码寄存器会记录下当前执行指令的条件判断状态，然后通过跳转指令读取对应的条件码，修改 PC 寄存器内的下一条指令的地址，最终实现 if...else 以及 for/while 这样的程序控制流程。</li></ul> <h2 id="elf-文件"><a href="#elf-文件" class="header-anchor">#</a> ELF 文件</h2> <p><img src="/blog/assets/img/elf_format.276a740d.jpg" alt="ELF 文件格式"></p> <p>链接器会扫描所有输入的目标文件，然后把所有符号表里的信息收集起来，构成一个全局的符号表。然后在根据重定位表，把所有不确定要跳转地址的代码，根据符号表里存储的地址，进行一个修正。最后，把所有目标文件的对应段进行一个合并，变成了最终的可执行文件。</p> <p><img src="/blog/assets/img/linker_process.f62da9b2.jpeg" alt="ELF 文件格式"></p> <p>装载器不再需要考虑地址跳转的问题，只需要解析 ELF 文件，把对应的指令和数据，加载到内存里面供 CPU 执行就可以了。</p> <p>Linux 下可执行文件的格式是 <code>ELF</code>，Windows 下可执行文件的格式是 <code>PE</code>， Linux 下的装载器只能解析 ELF 格式而不能解析 PE 格式。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Linux 下著名的开源软件 Wine，就是通过兼容 PE 格式装载器，使得我们能直接在 Linux 下运行 Windows 程序。</p> <p>Windows 的 WSL 可以解析和加载 ELF 格式的文件。</p></div> <h2 id="程序装载"><a href="#程序装载" class="header-anchor">#</a> 程序装载</h2> <h3 id="虚实转换"><a href="#虚实转换" class="header-anchor">#</a> 虚实转换</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>我们把指令里用到的内存地址叫做<strong>虚拟内存地址</strong>，实际在内存硬件里面的空间地址叫做<strong>物理内存地址</strong>。</p></div> <p>对于任何一个程序来说，它看到的都是同样的内存地址，我们维护一个虚拟内存到物理内存的映射表，这样实际程序指令执行的时候，会通过虚拟内存地址，找到对应的物理内存地址，然后执行。因为是连续的内存地址空间，所有我们只需要维护映射关系的起始地址和对应的空间大小就可以了。</p> <h3 id="内存分段-页"><a href="#内存分段-页" class="header-anchor">#</a> 内存分段/页</h3> <p><img src="/blog/assets/img/memory_segmentation.57211af3.png" alt="内存分段"></p> <p>如上图所示，内存分段会带来内存碎片的问题，解决办法是<strong>内存交换</strong>。</p> <p>硬盘的访问速度要比内存慢很多，如果内存交换的时候，交换的是一个很占内存空间的程序，这样整个机器都会显得卡顿。解决的办法是<strong>内存分页</strong>，在需要进行内存交换的时候，让需要交换写入或者从磁盘装载的数据更少一点。</p> <p>分段是将一整段连续连续的空间映射给程序，分页是把整个物理内存空间切成一段段固定尺寸的大小。对应的应用程序所需要占用的虚拟内存空间，也会同样切成一段段固定尺寸的大小。这样一个连续并且尺寸固定的内存空间称为<strong>页</strong>。从虚拟内存到物理内存的映射，不再是拿整段连续内存的物理地址，而是按照一个一个页来的。在 Linux 下，我们通常只设置成 4KB。</p> <p><img src="/blog/assets/img/memory_paging.0cf2f08e.png" alt="内存分页"></p> <p>由于内存空间都是预先划分好的，也就没有了不能使用的碎片，而只有被释放出来的很多 4KB 的页。即使内存空间不够，需要让现有的、正在运行的其它程序通过内存交换释放出一些内存页来，一次性写入磁盘的也只有少数的一个页或者几个页。</p> <p>更进一步，分页的方式使得我们在装载程序的时候，不再需要一次性把程序加载到物理内存中。我们完全可以在进行虚拟内存和物理内存的页之间的映射之后，并不真的把页加载到物理内存里，而是只在程序运行中，需要用到对应虚拟内存页里面的指令和数据时，再加载到物理内存里面去。</p> <h2 id="动态链接"><a href="#动态链接" class="header-anchor">#</a> 动态链接</h2> <p><img src="/blog/assets/img/dynamic_link.8cab516a.jpeg" alt="动态链接"></p> <p>想要在程序运行的时候共享代码，有一定的要求，就是这些机器码必须是<strong>地址无关</strong>的，即编译出来的共享库文件的指令代码是地址无关码。常见的地址相关的代码：</p> <ul><li>绝对地址代码</li> <li>利用重定位表的代码</li></ul> <h3 id="plt-procedure-link-table-和-got-global-offset-table"><a href="#plt-procedure-link-table-和-got-global-offset-table" class="header-anchor">#</a> PLT(Procedure Link Table) 和 GOT(Global Offset Table)</h3> <p><img src="/blog/assets/img/plt_got_table.1144d3a2.jpg" alt="PLT和GOT"></p> <p>在动态链接对应的共享库时，我们在共享库的 data section 里面，保存了一张 GOT 表，GOT 表在内存里和对应的代码段之间的偏移量始终是确定的。<strong>虽然共享库的代码部分的物理内存是共享的，但是数据部分是各个动态链接它的应用程序里面各加载一份的</strong>。GOT 表里的数据，是在我们加载一个个共享库的时候写进去的。<strong>不同的进程，调用同样的 lib.so，各自 GOT 里面指向最终加载的动态链接库里面的虚拟内存地址是不同的</strong>。这有点像 C 语言里用函数指针来调用对应的函数，并不是通过预先已经确定好的函数名来调用，而是利用当时它在内存里面的动态地址来调用。</p> <h2 id="二进制编码"><a href="#二进制编码" class="header-anchor">#</a> 二进制编码</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>原码和补码的区别：</p> <p>原码使用最高位来表示符号，且最高位不参与数值运算；</p> <p>补码也使用最高位表示符号，但是最高位也会参与数值运算。</p></div> <p>用补码表示负数，使得整数相加变得更加容易，不需要特殊处理，也意味着它们是同样的电路。</p> <h2 id="unicode-和-utf-8"><a href="#unicode-和-utf-8" class="header-anchor">#</a> Unicode 和 UTF-8</h2> <p>Unicode 是一个字符集(Charset)，包含了 150 种语言的 14 万个不同的字符。</p> <p>UTF-8 是一种字符编码(Character Encoding)，主要解决如何使用二进制来表示字符集里的字符。</p> <p><img src="/blog/assets/img/charset_encoding.9911c58d.jpg" alt="字符集和字符编码"></p> <p>如果某些字符在 Unicode 中并不存在，那么 Unicode 会统一把这些字符记录为 U+FFFD 这个编码，如果使用 UTF-8 的格式存储下来，就是 \xef\xbf\xbd。如果连续两个这样的字符放在一起，\xef\xbf\xbd\xef\xbf\xbd，这时如果用 GB2312 的方式进行 decode，就会变成“锟斤拷”。</p> <h2 id="加法器"><a href="#加法器" class="header-anchor">#</a> 加法器</h2> <p><img src="/blog/assets/img/gate_circuit.94194480.jpg" alt="门电路符号"></p> <h3 id="半加器"><a href="#半加器" class="header-anchor">#</a> 半加器</h3> <p><img src="/blog/assets/img/half_adder.5860fd8c.jpg" alt="半加器"></p> <h3 id="全加器"><a href="#全加器" class="header-anchor">#</a> 全加器</h3> <p><img src="/blog/assets/img/full_adder.3f11f278.jpg" alt="全加器"></p> <h3 id="_8-位加法器"><a href="#_8-位加法器" class="header-anchor">#</a> 8 位加法器</h3> <p><img src="/blog/assets/img/8_bit_adder.68cd3891.jpeg" alt="8比特加法器"></p> <h2 id="乘法器"><a href="#乘法器" class="header-anchor">#</a> 乘法器</h2> <p><img src="/blog/assets/img/sequent_multiply.cb809de1.jpg" alt="乘法器硬件结构"></p> <p>先拿乘数最右侧的个位乘以被乘数，把结果写入用来存放计算结果的开关里面，然后乘数左移一位，乘数右移一位，仍然用乘数去乘以被乘数，把结果加到刚才的结果上。反复重复这一步骤，直到不能再左移和右移位置。这样仅仅需要简单的加法器、一个左移一位的电路和右移一位的电路，就能完成整个乘法。</p> <p>这种乘法器中的每一组加法都要依赖上一组加法后的结果，整个算法是<strong>顺序</strong>的。</p> <h4 id="示例-13x9-（二进制-1101-x-1001）"><a href="#示例-13x9-（二进制-1101-x-1001）" class="header-anchor">#</a> 示例 13x9 （二进制 1101 x 1001）</h4> <p><img src="/blog/assets/img/multiply_example.0615e5e4.jpeg" alt="乘法器计算示例"></p> <h2 id="定点数"><a href="#定点数" class="header-anchor">#</a> 定点数</h2> <p>用 4 个比特来表示 0～9 的整数，那么 32 个比特就可以表示 8 个这样的整数。然后我们把最右边的 2 个 0～9 的整数当成小数部分；把左边 6 个 0～9 的整数当成整数部分，这样我们就可以用 32 个比特来表示从0～999999.99 这样 1 亿个实数。</p> <p>这种用二进制来表示十进制的编码方式叫作<strong>BCD编码</strong>，常用在超市、银行这样需要小数记录金额的情况里。</p> <p><img src="/blog/assets/img/BCD_encoding.f5a0b0f2.jpg" alt="BCD 编码"></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>定点数的表示方式有几个缺点：</p> <ol><li>表示方式有点“浪费”</li> <li>没有办法同时表示很大的数字和很小的数字</li></ol></div> <h2 id="浮点数"><a href="#浮点数" class="header-anchor">#</a> 浮点数</h2> <p>计算机使用科学计数法来表示实数，浮点数的科学计数法表示有一个 IEEE 标准，它定义了两个基本的格式，一个是用 32 比特表示单精度的浮点数，另外一个是用 64 比特表示双精度的浮点数。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在浮点数里，我们不像整数分符号数和无符号数，所有额浮点数都是有符号的。</p></div> <p><img src="/blog/assets/img/ieee_float32.914b71bf.jpg" alt="IEEE float格式"></p> <p>浮点数可以表示成这样：<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-msup><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-script style="vertical-align:0.363em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="s"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mo space="3" class="mjx-n"><mjx-c c="D7"></mjx-c></mjx-mo><mjx-mn space="3" class="mjx-n"><mjx-c c="1"></mjx-c><mjx-c c="."></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c c="f"></mjx-c></mjx-mi><mjx-mo space="3" class="mjx-n"><mjx-c c="D7"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-script style="vertical-align:0.363em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-math></mjx-container></p> <p><code>指数位 e</code>：8 个比特能够表示的整数空间是 0~255，IEEE 规定使用 <strong>1~254</strong> 映射到 <strong>-126~127</strong> 这 254 个有正有负的数上。因为浮点数不仅要表示很大的数，也要表示很小的数，所以指数位也会有负数。指数位的其他取值见下表：</p> <table><thead><tr><th>e</th> <th>f</th> <th>s</th> <th>浮点数</th></tr></thead> <tbody><tr><td>0</td> <td>0</td> <td>0 or 1</td> <td>0</td></tr> <tr><td>0</td> <td>!=0</td> <td>0 or 1</td> <td>0.f</td></tr> <tr><td>255</td> <td>0</td> <td>0</td> <td>无穷大</td></tr> <tr><td>255</td> <td>0</td> <td>1</td> <td>无穷小</td></tr> <tr><td>255</td> <td>!=0</td> <td>0 or 1</td> <td>NAN</td></tr></tbody></table> <h3 id="示例：浮点数的二进制转化（以-9-1-为例）"><a href="#示例：浮点数的二进制转化（以-9-1-为例）" class="header-anchor">#</a> 示例：浮点数的二进制转化（以 9.1 为例）</h3> <ol><li><p>整数部分转化为二进制：1001</p></li> <li><p>小数部分转化为二进制：</p> <p><img src="/blog/assets/img/float_example.f9213c43.jpg" alt="小数部分的二进制表示"></p></li> <li><p>整数和小数部分拼在一起，<code>1001.000110011...</code></p></li> <li><p>科学计数法表示：<mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c><mjx-c c="."></mjx-c><mjx-c c="0"></mjx-c><mjx-c c="0"></mjx-c><mjx-c c="1"></mjx-c><mjx-c c="0"></mjx-c></mjx-mn></mjx-math></mjx-container><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mn class="mjx-n"><mjx-c c="0"></mjx-c><mjx-c c="0"></mjx-c><mjx-c c="1"></mjx-c><mjx-c c="1"></mjx-c></mjx-mn></mjx-math></mjx-container><mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mn class="mjx-n"><mjx-c c="0"></mjx-c><mjx-c c="0"></mjx-c><mjx-c c="1"></mjx-c><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo space="2" class="mjx-n"><mjx-c c="2026"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="D7"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-script style="vertical-align:0.363em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="3"></mjx-c></mjx-mn></mjx-script></mjx-msup></mjx-math></mjx-container></p></li> <li><p>符号位 s=0；有效位f=001000110011...，因为 f 最长只有 23 位，于是 f=00100011001100110011001；指数应该是 3, 但是因为指数有正有负，指数位在 127 之前代表负数，之后代表正数，那 3 对应就是 130,转化成二进制就是 e=10000010</p> <p><img src="/blog/assets/img/float_example_result.9ace5a74.jpeg" alt="9.1 的二进制表示结果"></p></li></ol> <h3 id="浮点数的加法和精度损失"><a href="#浮点数的加法和精度损失" class="header-anchor">#</a> 浮点数的加法和精度损失</h3> <p>浮点数加法原则：<strong>先对齐、再计算</strong></p> <p>指数位较小的数，需要将有效位右移，在右移的过程中，最右侧的有效位就被丢弃掉了，这会导致指数位较小的数，在加法发生之前就丢失精度。两个相加数的指数位差的越大，位移的位数越大，可能丢失的精度也就越大。</p> <p>32位浮点数的有效长度一共只有23位，如果两个数的指数位相差23位，较小的数右移24位之后，所有的有效位就都丢失了。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FloatPrecision</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">float</span> x <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
    	sum <span class="token operator">+=</span> x<span class="token punctuation">;</span>    	
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sum is &quot;</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>   
  <span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>对应的输出结果是：<code>sum is 1.6777216E7</code>，因为加到1600万之后的加法因为精度丢失都没有了。</p> <p>解决办法是，在每次的计算过程中，都用一次减法，把当前加法计算中损失的精度记录下来，然后在后面的循环中，把这个精度损失放在要加的小数上，再做一次运算。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KahanSummation</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> c <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">float</span> x <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
    	<span class="token keyword">float</span> y <span class="token operator">=</span> x <span class="token operator">-</span> c<span class="token punctuation">;</span>
    	<span class="token keyword">float</span> t <span class="token operator">=</span> sum <span class="token operator">+</span> y<span class="token punctuation">;</span>
    	c <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token operator">-</span>sum<span class="token punctuation">)</span><span class="token operator">-</span>y<span class="token punctuation">;</span>
    	sum <span class="token operator">=</span> t<span class="token punctuation">;</span>    	
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sum is &quot;</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>   
  <span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="指令-运算-cpu"><a href="#指令-运算-cpu" class="header-anchor">#</a> 指令+运算=CPU</h2> <h3 id="指令周期"><a href="#指令周期" class="header-anchor">#</a> 指令周期</h3> <p>计算机每执行一条指令的过程可以分解成如下几个步骤：</p> <ol><li>Fetch（取得指令）：从 PC 寄存器里找到对应的指令地址，根据指令地址从内存里把具体的指令，加载到指令寄存器中，然后把 PC 寄存器自增。</li> <li>Decode（指令译码）：根据指令寄存器里面的指令，解析成要进行什么样的操作，具体要操作哪些寄存器、数据或者内存地址。</li> <li>Execute（执行指令）：进行算数逻辑操作、数据传输或者直接的地址跳转。</li></ol> <p>一轮 <strong>Fetch - Decode - Execute</strong> 的时间称为<strong>指令周期</strong>。</p> <p><img src="/blog/assets/img/instruction_cycle.bde3548a.jpeg" alt="指令周期"></p> <h3 id="机器周期"><a href="#机器周期" class="header-anchor">#</a> 机器周期</h3> <p>机器周期也叫 CPU 周期，CPU 内粗的操作速度很快，但是访问内存的速度却要慢很多，我们把从内存里面读取一条指令的最短时间称为 CPU 周期。</p> <h3 id="通过-d-触发器实现存储功能"><a href="#通过-d-触发器实现存储功能" class="header-anchor">#</a> 通过 D 触发器实现存储功能</h3> <h4 id="rs-触发器"><a href="#rs-触发器" class="header-anchor">#</a> RS 触发器</h4> <p><img src="/blog/assets/img/RS_flip_flop.dc6dcce6.jpeg" alt="RS触发器"></p> <p>真值表：</p> <table><thead><tr><th>S</th> <th>R</th> <th>Q</th></tr></thead> <tbody><tr><td>1</td> <td>0</td> <td>1</td></tr> <tr><td>0</td> <td>1</td> <td>0</td></tr> <tr><td>0</td> <td>0</td> <td>Q</td></tr> <tr><td>1</td> <td>1</td> <td>NA</td></tr></tbody></table> <p>往这个电路里加两个与门和一个时钟信号，就可以实现一个利用时钟信号来操作一个电路了。</p> <p><img src="/blog/assets/img/RS_flip_flop_with_clock.9e9bc411.jpeg" alt="RS触发器"></p> <h4 id="d-触发器"><a href="#d-触发器" class="header-anchor">#</a> D 触发器</h4> <p>把 R 和 S 两个信号通过一个反相器合并，我们可以通过一个数据信号 D 进行 Q 的写入操作。</p> <p><img src="/blog/assets/img/D_flip_flop.d749acce.jpeg" alt="D触发器"></p> <p>CPU 里面的寄存器可以直接通过 D 型触发器来构造。</p> <h3 id="自动计数器"><a href="#自动计数器" class="header-anchor">#</a> 自动计数器</h3> <p><img src="/blog/assets/img/PC_counter.1ed21092.jpg" alt="计数器"></p> <p>这个自动计数器可以拿来当作 PC 寄存器。</p> <p>加法计数、内存取值，乃至后面的命令执行，最终其实都是由我们一开始讲的时钟信号来控制执行时间点和先后顺序的，这也是我们需要时序电路最核心的原因。</p> <p>在最简单的情况下，我们让每一条指令，从程序计数，到获取指令、执行指令，都在一个时钟周期内完成，这样的 CPU 设计称为<strong>单指令周期处理器</strong>。</p> <h3 id="_2-1-选择器"><a href="#_2-1-选择器" class="header-anchor">#</a> 2-1 选择器</h3> <p><img src="/blog/assets/img/2-1_selector.383bfbb0.jpeg" alt="2-1选择器"></p> <p>一个反向器只能有0和1两个状态，我们只能从两个地址中选择一个。如果输入的信号有三个不同的开关，我们就能从8个地址中选择一个了，这样的电路，就叫<strong>3-8译码器</strong>。现代的计算机，如果 CPU 是 64 位的，就意味着寻址空间是 <mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-msup><mjx-mn class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-script style="vertical-align:0.363em;"><mjx-TeXAtom size="s"><mjx-mn class="mjx-n"><mjx-c c="6"></mjx-c><mjx-c c="4"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-msup></mjx-math></mjx-container> ，那么我们就需要一个有 64 个开关的译码器。</p> <p>当我们把译码器和内存连到一起时，通常会组成这样一个电路：</p> <p><img src="/blog/assets/img/decoder.4002b5f8.jpeg" alt="地址译码器"></p> <p>译码器的本质就是从输入的多位信号中，根据一定的开关和电路组合，选择出自己想要的信号。除了能够进行“寻址”之外，还可以把对应的需要运行的指令码，同样通过译码器，找出 opcode 以及后面对应的操作数或者寄存器地址。</p> <h2 id="构造一个最简单的-cpu"><a href="#构造一个最简单的-cpu" class="header-anchor">#</a> 构造一个最简单的 CPU</h2> <p><img src="/blog/assets/img/simplest_CPU.6863e10f.jpeg" alt="建立数据通路"></p> <h2 id="现代处理器的流水线设计"><a href="#现代处理器的流水线设计" class="header-anchor">#</a> 现代处理器的流水线设计</h2> <p>单指令周期处理器的时钟频率没法设的太高，因为有些复杂指令没有办法在一个时钟周期内运行完成。那么在下一个时钟周期到来，开始执行下一条指令的时候，前一条指令的执行结果可能还没有写入到寄存器里面，那下一条指令读取的数据就是不准确的，就会出现错误。</p> <p><img src="/blog/assets/img/CPU_pipeline.1e880fa8.jpeg" alt="流水线示意图"></p> <p>五级流水线就表示我们在同一个时钟周期里面，同时运行五条指令的不同阶段，这个时候虽然执行一条指令的始终周期变成了5,但是我们可以把CPU的主频提的更高了。我们不需要确保最复杂的那条指令在时钟周期里面执行完成，而只要保障一个最复杂的流水线的操作，在一个时钟周期内完成就好了。</p> <p>每一条指令从开始到结束拿到结果的时间并没有变化（即响应时间没有变化），但是同样时间内，完成的指令数增多了（即吞吐率上升了）。</p> <h3 id="超长流水线的性能瓶颈"><a href="#超长流水线的性能瓶颈" class="header-anchor">#</a> 超长流水线的性能瓶颈</h3> <p><img src="/blog/assets/img/CPU_pipeline_overhead.d9e141af.jpeg" alt="流水线性能瓶颈"></p> <p>每一级流水线对应的输出都要放到流水线寄存器里面，然后在下一个时钟周期，交给下一个流水线级去处理。随着流水线的不断加深，这些操作操作占整个指令的执行时间的比例就会不断增加。所以一味地增加流水线深度并不能无限地提高性能。</p> <h2 id="冒险-hazard"><a href="#冒险-hazard" class="header-anchor">#</a> 冒险 (Hazard)</h2> <h3 id="结构冒险"><a href="#结构冒险" class="header-anchor">#</a> 结构冒险</h3> <p><img src="/blog/assets/img/structure_hazard.c2a4c034.jpeg" alt="结构冒险"></p> <p>结构冒险，本质上是一个硬件层面的资源竞争问题。上图中，在第 1 条指令执行到 MEM 阶段的时候，流水线里的第 4 条指令，在执行指令 Fetch 的操作。访存和取指令都要进行内存数据的读取，而我们的内存只有一个地址译码器，只能在一个时钟周期里面读取一条数据。</p> <h4 id="哈佛结构"><a href="#哈佛结构" class="header-anchor">#</a> 哈佛结构</h4> <p>针对结构冒险的解决思路是<strong>增加资源</strong>，将内存拆分成两部分（存放指令的程序内存和存放数据的数据内存），各自有独立的地址译码器。这样把内存拆成两个部分的解决方案在计算机体系结构里称为<strong>哈佛架构</strong>。</p> <p><img src="/blog/assets/img/princeton_harvard.e7508cb4.jpeg" alt="哈佛结构"></p> <p>哈佛结构虽然解决了资源冲突的问题，但是失去了灵活性，我们没有办法根据实际的应用去动态分配内存了。</p> <p>现代了 CPU 虽然没有在内存层面进行对应的拆分，却在 CPU 内部的高速缓存部分进行了区分，把高速缓存分成了指令缓存和数据缓存。</p> <h4 id="指令对齐"><a href="#指令对齐" class="header-anchor">#</a> 指令对齐</h4> <p>不同类型的指令在流水线的不同阶段会进行不同的操作，比如 <code>LOAD</code>指令需要从内存里读取数据到寄存器，会经历 5 个完整的流水线。<code>STORE</code>这样从寄存器往内存里写数据的指令，不需要有写回寄存器的操作，也就是没有<code>WB</code>的流水线阶段。至于像<code>ADD</code>和<code>SUB</code>这样的加减法指令，所有的操作都在寄存器完成，所以没有实际的内存访问<code>MEM</code>操作。</p> <p>有些指令没有对应的流水线阶段，但是我们并不能跳过对应的阶段直接执行下一阶段，不然如果我们先后执行一条<code>LOAD</code> 指令和一条 <code>ADD</code> 指令，就会发生 <code>LOAD</code> 指令的 <code>WB</code> 阶段和 <code>ADD</code> 指令的 <code>WB</code> 阶段，在同一个时钟周期发生。这样，相当于触发了一个结构冒险事件，产生了资源竞争。所以，在实践当中，各个指令不需要的阶段，并不会直接跳过，而是会运行一次 <code>NOP</code> 操作。</p> <h3 id="数据冒险"><a href="#数据冒险" class="header-anchor">#</a> 数据冒险</h3> <p>数据冒险是指同时执行的多个指令之间有数据依赖的情况，这些数据依赖，可以分成三大类：<strong>先写后读</strong>，<strong>先读后写</strong>和<strong>写后在写</strong>。除了读之后再进行读，对于同一个寄存器或者内存地址的操作，都有着明确强制的顺序要求。</p> <p>解决数据冒险的一个简单办法就是<strong>流水线停顿</strong>，或者叫<strong>流水线冒泡</strong>。</p> <p><img src="/blog/assets/img/pipeline_bubble.0d762f2c.jpeg" alt="流水线冒泡"></p> <p>流水线停顿是以牺牲 CPU 性能为代价的，因为实际上在最差的情况下，流水线架构的 CPU 又会退化成单指令周期的 CPU 了。</p> <h4 id="操作数前推"><a href="#操作数前推" class="header-anchor">#</a> 操作数前推</h4> <p>假设有两条 <code>ADD</code> 指令先后发生：</p> <div class="language-assembly line-numbers-mode"><pre class="language-text"><code>add $t0, $s2,$s1
add $s2, $s1,$t0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>后一条指令依赖寄存器 <code>t0</code> 里的值，而 <code>t0</code> 的值又来自前一条指令的计算结果，所以后一条需要等待前一条指令的数据写回阶段完成之后才能执行。</p> <p><img src="/blog/assets/img/two_add_instructions.94dda233.jpeg" alt="指令之间的数据依赖"></p> <p>我们完全可以在第一条指令的执行阶段完成之后，直接将结果数据传输到下一条指令的 ALU，然后，下一条指令不需要再插入两个 NOP 阶段，就可以继续正常走到执行阶段。</p> <p><img src="/blog/assets/img/operant_forwarding.dceadd35.jpeg" alt="操作数前推"></p> <h4 id="乱序执行-out-of-order-execution-oooe"><a href="#乱序执行-out-of-order-execution-oooe" class="header-anchor">#</a> 乱序执行(Out-of-Order Execution, OoOE)</h4> <p>从软件开发的维度思考，乱序执行好像是在指令的执行阶段，引入了一个“线程池”。</p> <p><img src="/blog/assets/img/OoOE.153f8d5e.jpeg" alt="乱序执行"></p> <ol><li>在取指令和指令译码的时候，乱序执行的CPU和其他使用流水线架构的CPU是一样的。它会一级一级顺序地进行取指令和指令译码的工作。</li> <li>在指令译码完成之后，就不一样了。CPU不会直接进行指令执行，而是进行一次指令分发，把指令发到一个叫作保留站 (Reservation Stations) 的地方。顾名思义，这个保留站，就像一个火车站一样。发送到车站的指令，就像是一列列的火车。</li> <li>这些指令不会立刻执行，而要等待它们所依赖的数据，传递给它们之后才会执行。这就好像一列列的火车都要等到乘客来齐了才能出发。</li> <li>一旦指令依赖的数据来齐了，指令就可以交到后面的功能单元 (Function  Unit，FU)，其实就是 ALU，去执行了。我们有很多功能单元可以并行运行，但是不同的功能单元能够支持执行的指令并不相同。就和我们的铁轨一样，有些从上海北上，可以到北京和哈尔滨；有些是南下的，可以到广州和深圳。</li> <li>指令执行的阶段完成之后，我们并不能立刻把结果写回到寄存器里面去，而是把结果再存放到一个叫作重排序缓冲区 (Re-Order Buffer，ROB) 的地方。</li> <li>在重排序缓冲区里，我们的 CPU 会按照取指令的顺序，对指令的计算结果重新排序。只有排在前面的指令都已经完成了，才会提交指令，完成整个指令的运算结果。</li> <li>实际的指令的计算结果数据，并不是直接写到内存或者高速缓存里，而是先写入存储缓冲区 (Store Buffer) 里面，最终才会写入到高速缓存和内存里。</li></ol> <p>即便指令的执行过程中是乱序的，我们在最终指令的计算结果写入到寄存器和内存之前，依然会进行一次排序，以确保所有指令在外部看来仍然是有序完成的。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在现代 Intel 的 CPU 的乱序执行的过程中，只有指令的执行阶段是乱序的，后面的内存访问和数据写回阶段都仍然是顺序的。</p></div> <h3 id="控制冒险"><a href="#控制冒险" class="header-anchor">#</a> 控制冒险</h3> <p>在 <code>jmp</code> 指令发生的时候，CPU 可能会跳转去执行其他指令，紧跟 <code>jmp</code> 后的那一条指令之否应该顺序加载执行，在流水线厘米那进行取指令的时候，我们没法知道，要等 <code>jmp</code> 指令执行完成，去更新了 PC 寄存器之后我们才能知道，是否执行下一条指令，还是跳转到另外一个内存地址，去取别的指令。这种为了确保能够取到正确的指令，而不得不进行等待延迟的情况，就是<strong>控制冒险</strong>。</p> <h4 id="缩短分支延迟"><a href="#缩短分支延迟" class="header-anchor">#</a> 缩短分支延迟</h4> <p>条件跳转指令其实进行了两种电路操作，第一种是进行条件比较，需要的输入是，根据指令的 opcode，就能确认条件码寄存器。第二种是进行实际的跳转，即把要跳转的地址信息写入到 PC 寄存器。无论是 opcode 还是对应的条件码寄存器，还是跳转地址，都是在指令译码阶段就能获得的，而对应的条件比较电路，只要是简单的逻辑门电路就可以了，并不需要一个完整而复杂的 ALU。所以，我们可以将条件判断、地址跳转都提前到指令译码阶段进行，而不需要放在指令执行阶段。</p> <h4 id="动态分支预测-branch-prediction"><a href="#动态分支预测-branch-prediction" class="header-anchor">#</a> 动态分支预测 (Branch Prediction)</h4> <p><img src="/blog/assets/img/branch_prediction.ea82f279.jpeg" alt="分支预测"></p> <p>这个状态机里，我们一共有4个状态，所以我们需要2个比特来记录对应的状态。这样这整个策略，就可以叫作<strong>2比特饱和计数</strong>，或者叫<strong>双模态预测器</strong> (Bimodal Predictor)。</p> <h2 id="多发射和超标量"><a href="#多发射和超标量" class="header-anchor">#</a> 多发射和超标量</h2> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://www.coursera.org/learn/jisuanji-zucheng" target="_blank" rel="noopener noreferrer">coursera 公开课《计算机组成》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.bilibili.com/video/av24540152/" target="_blank" rel="noopener noreferrer">CSAPP 深入理解计算机系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/suda-morris/blog/edit/master/docs/cs/computer_composition.md" target="_blank" rel="noopener noreferrer">编辑此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/9/2019, 2:30:20 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/cs/cmake.html" class="prev">𝘾𝙈𝙖𝙠𝙚 基础</a></span> <span class="next"><a href="/blog/cs/design_pattern.html">设计模式 𝘾 语言描述</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.90b00457.js" defer></script><script src="/blog/assets/js/2.791c5530.js" defer></script><script src="/blog/assets/js/3.045f78bc.js" defer></script><script src="/blog/assets/js/8.f5935c22.js" defer></script>
  </body>
</html>
